trigger:
  - none

variables:
  - template: vars/vars-global.yaml
  - template: vars/vars-dev.yaml

pool:
  vmImage: windows-latest

steps:
  - task: TerraformInstaller@1
    displayName: 'Terraform install'
    inputs:
      terraformVersion: "latest"

  - task: TerraformTaskV4@4
    displayName: 'Terraform init'
    inputs:
      provider: "azurerm"
      command: "init"
      backendServiceArm: $(subscription)
      backendAzureRmResourceGroupName: $(resource-group)
      backendAzureRmStorageAccountName: $(storage-account)
      backendAzureRmContainerName: $(container-name)
      backendAzureRmKey: "$(tfstate-key)-$(environment).tfstate"

  - task: TerraformTaskV4@4
    displayName: 'Terraform apply'
  inputs:
    provider: 'azurerm'
    command: 'apply'
    environmentServiceNameAzureRM: "$(subscription)"