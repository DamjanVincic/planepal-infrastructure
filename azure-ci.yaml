trigger:
- none

variables:
- template: vars/vars-global.yaml
- template: vars/vars-dev.yaml

pool:
  vmImage: ubuntu-latest

steps:
- task: TerraformInstaller@1
  inputs:
    terraformVersion: 'latest'

- task: TerraformTaskV4@4
  inputs:
    provider: 'azurerm'
    command: 'init'
    backendServiceArm: ${{ variables.subscription }}
    backendAzureRmResourceGroupName: ${{ variables.resource-group  }}
    backendAzureRmStorageAccountName: ${{ variables.storage-account }}
    backendAzureRmContainerName: ${{ variables.container-name }}
    backendAzureRmKey: '${{ variables.tfstate-key }}-${{ variables.environment}}.tfstate'

- task: TerraformTaskV4@4
  inputs:
    provider: 'azurerm'
    command: 'validate'
    
- task: TerraformTaskV4@4
  inputs:
    provider: 'azurerm'
    command: 'plan'
    # commandOptions: '-out=plan'
    environmentServiceNameAzureRM: $(subscription)
